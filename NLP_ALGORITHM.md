# üß† –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π NLP-–∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —Ä–∞–∑–Ω–æ—Å–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π NLP-–∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏–∫ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

### 1Ô∏è‚É£ Multi-Query (–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)

**–¶–µ–ª—å:** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–º—ã—Å–ª–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü.

**–ü—Ä–∏–º–µ—Ä:**
```
–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç: "–û–ø–ª–∞—Ç–∞ –∑–∞ —Ü–≤–µ—Ç—ã. –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ["–û–ø–ª–∞—Ç–∞ –∑–∞ —Ü–≤–µ—Ç—ã", "–î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º"]
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∑–Ω–∞–∫–∞–º –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è (`.`, `!`, `?`, `;`, `,`)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö –∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (< 3 —Å–∏–º–≤–æ–ª–æ–≤)
- –ö–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

### 2Ô∏è‚É£ –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è (pymorphy2)

**–¶–µ–ª—å:** –ü—Ä–∏–≤–µ—Å—Ç–∏ —Å–ª–æ–≤–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ –¥–ª—è –ª—É—á—à–µ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä:**
```
"—Ü–≤–µ—Ç–æ—á–∫–∏" ‚Üí "—Ü–≤–µ—Ç–æ–∫"
"–∫—É–ø–∏–ª–∏" ‚Üí "–∫—É–ø–∏—Ç—å"
"–∫—Ä–∞—Å–∏–≤—ã–µ" ‚Üí "–∫—Ä–∞—Å–∏–≤—ã–π"
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `pymorphy2` –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (LRU cache –Ω–∞ 1000 –∑–∞–ø–∏—Å–µ–π)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –≥–ª–∞–≥–æ–ª–æ–≤ –∫–∞–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

### 3Ô∏è‚É£ –°–∏–Ω–æ–Ω–∏–º—ã (RuWordNet)

**–¶–µ–ª—å:** –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ —Å–ª–æ–≤–∞.

**–ü—Ä–∏–º–µ—Ä:**
```
"—Ü–≤–µ—Ç–æ–∫" ‚Üí {"—Ç—é–ª—å–ø–∞–Ω", "—Ä–æ–∑–∞", "–±—É–∫–µ—Ç", "—Ä–∞—Å—Ç–µ–Ω–∏–µ", ...}
"–æ–ø–ª–∞—Ç–∞" ‚Üí {"–ø–ª–∞—Ç—ë–∂", "—Ä–∞—Å—á—ë—Ç", "–≤—ã–ø–ª–∞—Ç–∞", ...}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RuWordNet` - —Ä—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è WordNet
- –ë–µ—Ä—É—Ç—Å—è –ø–µ—Ä–≤—ã–µ 3 —Å–∏–Ω—Å–µ—Ç–∞, –¥–æ 10 —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –Ω–∞ —Å–ª–æ–≤–æ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (LRU cache –Ω–∞ 500 –∑–∞–ø–∏—Å–µ–π)

### 4Ô∏è‚É£ Vector Search (–ü–æ–∏—Å–∫ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º)

**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä:**
```
calculate_similarity("–æ–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤", "–ª–æ–≥–∏—Å—Ç–∏–∫–∞") ‚Üí 0.72
calculate_similarity("–æ–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤", "—Ä–µ–∫–ª–∞–º–∞") ‚Üí 0.15
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI Embeddings API (`text-embedding-3-small`)
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏—Ö—Å—è —Ç–µ–∫—Å—Ç–æ–≤

### 5Ô∏è‚É£ Keyword Boost (–ë–æ–Ω—É—Å –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ª–µ–º–º)

**–¶–µ–ª—å:** –£–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ª–µ–º–º.

**–ë–æ–Ω—É—Å:** +0.15 –∫ –±–∞–∑–æ–≤–æ–º—É —Å–∫–æ—Ä—É

**–ü—Ä–∏–º–µ—Ä:**
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: "–ö—É–ø–∏–ª–∏ –∫—Ä–∞—Å–∏–≤—ã–µ —Ü–≤–µ—Ç–æ—á–∫–∏"
–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: "—Ü–≤–µ—Ç–æ–∫"

–õ–µ–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: {"–∫—É–ø–∏—Ç—å", "–∫—Ä–∞—Å–∏–≤—ã–π", "—Ü–≤–µ—Ç–æ–∫"}
–õ–µ–º–º–∞ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞: "—Ü–≤–µ—Ç–æ–∫"

–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ! ‚Üí –ë–æ–Ω—É—Å +0.15
```

### 6Ô∏è‚É£ Exact Match (–ë–æ–Ω—É—Å –∑–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)

**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å –ø—Ä–∏ —Ç–æ—á–Ω–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Å–ª–æ–≤–∞.

**–ë–æ–Ω—É—Å:** +0.25 –∫ –±–∞–∑–æ–≤–æ–º—É —Å–∫–æ—Ä—É

**–ü—Ä–∏–º–µ—Ä:**
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: "–û–ø–ª–∞—Ç–∞ –∑–∞ —Ü–≤–µ—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫—É"
–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: "—Ü–≤–µ—Ç—ã"

"—Ü–≤–µ—Ç—ã" in "–æ–ø–ª–∞—Ç–∞ –∑–∞ —Ü–≤–µ—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫—É" ‚Üí True
–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ! ‚Üí –ë–æ–Ω—É—Å +0.25
```

### 7Ô∏è‚É£ Synonym Match (–ë–æ–Ω—É—Å –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤)

**–¶–µ–ª—å:** –£—á–µ—Å—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –±–ª–∏–∑–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Å–∏–Ω–æ–Ω–∏–º—ã.

**–ë–æ–Ω—É—Å:** +0.10 –∫ –±–∞–∑–æ–≤–æ–º—É —Å–∫–æ—Ä—É

**–ü—Ä–∏–º–µ—Ä:**
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: "–ü–æ–∫—É–ø–∫–∞ –±—É–∫–µ—Ç–∞ —Ä–æ–∑"
–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: "—Ü–≤–µ—Ç–æ–∫"

–°–∏–Ω–æ–Ω–∏–º—ã "—Ü–≤–µ—Ç–æ–∫": {"—Ä–æ–∑–∞", "—Ç—é–ª—å–ø–∞–Ω", "–±—É–∫–µ—Ç", ...}
–õ–µ–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: {"–ø–æ–∫—É–ø–∫–∞", "–±—É–∫–µ—Ç", "—Ä–æ–∑–∞"}

–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: {"–±—É–∫–µ—Ç", "—Ä–æ–∑–∞"} ‚Üí –ë–æ–Ω—É—Å +0.10
```

## –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Å–∫–æ—Ä–∞

```python
final_score = min(
    base_embedding_similarity 
    + (0.25 if exact_match else 0)
    + (0.15 if lemma_match else 0)
    + (0.10 if synonym_match else 0),
    1.0  # –ú–∞–∫—Å–∏–º—É–º
)
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**
```
"–û–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É. –°—Ä–æ—á–Ω–∞—è –∫—É—Ä—å–µ—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞"
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:**
```python
{
    "–õ–æ–≥–∏—Å—Ç–∏–∫–∞": ["–¥–æ—Å—Ç–∞–≤–∫–∞", "–∫—É—Ä—å–µ—Ä", "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"],
    "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥": ["—Ä–µ–∫–ª–∞–º–∞", "–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ"],
    "–û—Ñ–∏—Å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã": ["–∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è", "–æ—Ñ–∏—Å"]
}
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### –®–∞–≥ 1: Multi-Query
```
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
1. "–û–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É"
2. "–°—Ä–æ—á–Ω–∞—è –∫—É—Ä—å–µ—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞"
```

#### –®–∞–≥ 2: –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è
```
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: ["–æ–ø–ª–∞—Ç–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞", "—Ü–≤–µ—Ç–æ–∫", "–∫–ª–∏–µ–Ω—Ç", "—Å—Ä–æ—á–Ω—ã–π", "–∫—É—Ä—å–µ—Ä—Å–∫–∏–π", "—Å–ª—É–∂–±–∞"]
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–õ–æ–≥–∏—Å—Ç–∏–∫–∞", –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "–¥–æ—Å—Ç–∞–≤–∫–∞"

**Vector Search:**
```
similarity("–û–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É", "–¥–æ—Å—Ç–∞–≤–∫–∞") = 0.68
```

**Exact Match:**
```
"–¥–æ—Å—Ç–∞–≤–∫–∞" in "–æ–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É" ‚Üí True
–ë–æ–Ω—É—Å: +0.25
```

**Lemma Match:**
```
"–¥–æ—Å—Ç–∞–≤–∫–∞" in {"–æ–ø–ª–∞—Ç–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞", "—Ü–≤–µ—Ç–æ–∫", ...} ‚Üí True
–ë–æ–Ω—É—Å: +0.15
```

**Synonym Match:**
```
–°–∏–Ω–æ–Ω–∏–º—ã "–¥–æ—Å—Ç–∞–≤–∫–∞": {"–∫—É—Ä—å–µ—Ä", "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞", ...}
"–∫—É—Ä—å–µ—Ä—Å–∫–∏–π" ‚Üí "–∫—É—Ä—å–µ—Ä" (–ª–µ–º–º–∞)
–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ!
–ë–æ–Ω—É—Å: +0.10
```

**–ò—Ç–æ–≥–æ–≤—ã–π —Å–∫–æ—Ä:**
```
0.68 + 0.25 + 0.15 + 0.10 = 1.18 ‚Üí 1.0 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –º–∞–∫—Å–∏–º—É–º–æ–º)
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç

```
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: "–õ–æ–≥–∏—Å—Ç–∏–∫–∞"
‚úÖ –°–∫–æ—Ä: 1.000
‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –±—É—Å—Ç—ã: exact, lemma, synonym
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏:

```
[CATEGORY-NLP][batch-uuid] –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: –õ–æ–≥–∏—Å—Ç–∏–∫–∞ (score=1.000) [boosts: exact, lemma, synonym]
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (Threshold)

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–∫–æ—Ä –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.7)

```python
# –í .env
EMBEDDING_SIMILARITY_THRESHOLD=0.7
```

### Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ï—Å–ª–∏ NLP –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (—Å–∫–æ—Ä < threshold):

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ –ò–ù–ù** - –µ—Å–ª–∏ –µ—Å—Ç—å –ò–ù–ù –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `ContractorExpenseMapping`
2. **–û—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º** - –µ—Å–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ –Ω–µ—Ç, –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è `None`

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **LRU –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è: 1000 –∑–∞–ø–∏—Å–µ–π
   - –°–∏–Ω–æ–Ω–∏–º—ã: 500 –∑–∞–ø–∏—Å–µ–π
   - –≠–º–±–µ–¥–¥–∏–Ω–≥–∏: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ (–≤ `embedding_cache.py`)

2. **Lazy loading:**
   - `pymorphy2` –∏ `RuWordNet` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
   - Singleton –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

3. **Graceful degradation:**
   - –ï—Å–ª–∏ `pymorphy2` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí –ø—Ä–æ—Å—Ç–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `.lower()`
   - –ï—Å–ª–∏ `RuWordNet` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Å–∏–Ω–æ–Ω–∏–º–æ–≤

### –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

- –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: **50-150ms** (—Å —Ö–æ–ª–æ–¥–Ω—ã–º –∫—ç—à–µ–º)
- –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: **5-15ms** (—Å –ø—Ä–æ–≥—Ä–µ—Ç—ã–º –∫—ç—à–µ–º)
- Batch –∏–∑ 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: **~2-5 —Å–µ–∫—É–Ω–¥**

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install pymorphy2 pymorphy2-dicts-ru ruwordnet
```

–ò–ª–∏ —á–µ—Ä–µ–∑ `requirements.txt`:

```bash
pip install -r requirements.txt
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from coin_desk.utils.nlp_processor import get_category_matcher

matcher = get_category_matcher()

category, score, boosts = matcher.find_best_category(
    transaction_text="–û–ø–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Ü–≤–µ—Ç–æ–≤",
    category_keywords={
        "–õ–æ–≥–∏—Å—Ç–∏–∫–∞": ["–¥–æ—Å—Ç–∞–≤–∫–∞", "–∫—É—Ä—å–µ—Ä"],
        "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥": ["—Ä–µ–∫–ª–∞–º–∞", "–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ"]
    },
    threshold=0.7
)

print(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}, –°–∫–æ—Ä: {score:.3f}")
# –í—ã–≤–æ–¥: –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –õ–æ–≥–∏—Å—Ç–∏–∫–∞, –°–∫–æ—Ä: 1.000
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from coin_desk.utils.nlp_processor import get_nlp_processor

nlp = get_nlp_processor()

# –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è
lemma = nlp.lemmatize("—Ü–≤–µ—Ç–æ—á–∫–∏")  # ‚Üí "—Ü–≤–µ—Ç–æ–∫"

# –°–∏–Ω–æ–Ω–∏–º—ã
synonyms = nlp.get_synonyms("—Ü–≤–µ—Ç–æ–∫")  # ‚Üí {"—Ä–æ–∑–∞", "—Ç—é–ª—å–ø–∞–Ω", ...}

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
keywords = nlp.extract_keywords("–ö—É–ø–∏–ª–∏ –∫—Ä–∞—Å–∏–≤—ã–µ —Ü–≤–µ—Ç—ã")  # ‚Üí ["–∫—É–ø–∏—Ç—å", "—Ü–≤–µ—Ç–æ–∫"]

# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
expanded = nlp.expand_query_with_synonyms("–¥–æ—Å—Ç–∞–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤")
# ‚Üí {"–¥–æ—Å—Ç–∞–≤–∫–∞", "—Ü–≤–µ—Ç–æ–∫", "–∫—É—Ä—å–µ—Ä", "—Ä–æ–∑–∞", "—Ç—é–ª—å–ø–∞–Ω", ...}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `debug.log` —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[CATEGORY-NLP]`:

```bash
tail -f debug.log | grep "CATEGORY-NLP"
```

### –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏

```python
from coin_desk.models import Transaction

# –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ NLP
nlp_transactions = Transaction.objects.filter(category_source='nlp')

print(f"–í—Å–µ–≥–æ NLP-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–π: {nlp_transactions.count()}")
```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è

1. **Machine Learning:**
   - –û–±—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - Fine-tuning —ç–º–±–µ–¥–¥–∏–Ω–≥-–º–æ–¥–µ–ª–∏ –Ω–∞ –¥–æ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑:**
   - –£—á–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞
   - –ê–Ω–∞–ª–∏–∑ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤

3. **Feedback loop:**
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ä—É—á–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤ –∏ –≤–µ—Å–æ–≤

4. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å:**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## –ê–≤—Ç–æ—Ä—ã

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **CoinCounter**.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
